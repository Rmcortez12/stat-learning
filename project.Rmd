---
title: "Project RMD"
author: "Group 2"
date: "11/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#Load Data

setwd("d:/UTSA/Fall2020/DataMining/Project/stat-learning") # set working directory
df = read.csv('FinalDF.csv') # read in raw csv data


df$Age15_19 = as.factor(df$Age15_19)
df$Age20_24 = as.factor(df$Age20_24)
df$Age25_29 = as.factor(df$Age25_29)
df$Age30_34 = as.factor(df$Age30_34)
df$Age35_39 = as.factor(df$Age35_39)
df$Age40_44 = as.factor(df$Age40_44)
df$Age45_49 = as.factor(df$Age45_49)
df$Age50_54 = as.factor(df$Age50_54)
df$Age55_59 = as.factor(df$Age55_59)
df$Age60_64 = as.factor(df$Age60_64)

df$Australia = as.factor(df$Australia)
df$Belarus = as.factor(df$Belarus)
df$Belgium = as.factor(df$Belgium)
df$Canada = as.factor(df$Canada)
df$Denmark = as.factor(df$Denmark)
df$Finland = as.factor(df$Finland)
df$France = as.factor(df$France)
df$Germany = as.factor(df$Germany)
df$India = as.factor(df$India)
df$Ireland = as.factor(df$Ireland)
df$Japan = as.factor(df$Japan)
df$Mexico = as.factor(df$Mexico)
df$NZ = as.factor(df$NZ)
df$Russia = as.factor(df$Russia)
df$Singapore = as.factor(df$Singapore)
df$Spain = as.factor(df$Spain)
df$Sweden = as.factor(df$Sweden)
df$Switzerland = as.factor(df$Switzerland)
df$Ukraine = as.factor(df$Ukraine)
df$UK= as.factor(df$UK)
df$US= as.factor(df$US)

#update belarus temps
df$difference[163] = 10 
df$difference[177] = 10 
df$difference[224] = 10 
df$difference[255] = 10 
df$difference[266] = 10

#full model 
fit.lm = lm(Yards ~ .- Runner-Max-Min-Avg-Team-Age-X ,data = df)
summary(fit.lm)

pairs(df[,grepl("avg_rate",names(df))])
pairs(df[,grepl("median_rate.",names(df))])
pairs(df[,grepl("rate_sd.",names(df))])

exclude_vars <- names(df) %in% c("Runner" ,"Max", "Min", "Avg" ,"Age", "Team", "Gen", "X")
df.filtered <-df[,!exclude_vars]

#test
```

```{r}
#Run Model w/ interaction effects no age
fit.lm.1 = lm(Yards ~ rate_sd1*rate_sd4+rate_sd2+rate_sd3+
                avg_rate_q2+avg_rate_q3+avg_rate_q4+
                median_rate_q1+median_rate_q2+median_rate_q3+median_rate_q4+
                Finland:difference+
                Canada:difference+
                Ukraine:difference+
                Switzerland:difference+
                Denmark:difference+
                Belgium:difference+
                Ireland:difference+
                UK:difference+
                Germany:difference+
                France:difference+
                NZ:difference+
                US:difference+
                Japan:difference+
                Spain:difference+
                Australia:difference+
                Mexico:difference+
                India:difference+
                Singapore:difference+
                Russia:difference+
                Belarus:difference+
                Belarus:difference
                ,data = df.filtered)

anova(fit.lm.1)

summary(fit.lm.1)

par(mfrow=c(2,2))
plot(fit.lm.1)
cor(df.filtered[,1:13])
```

```{r}

#transform y
df.filtered$logYards = log(df.filtered$Yards)


fit.lm.2 = lm(logYards ~ rate_sd1+rate_sd2+rate_sd_diff_4_1+
                avg_rate_q2+avg_rate_q3+avg_rate_q4+
                median_rate_q1+median_rate_q2+median_rate_q3+median_rate_q4+
                Finland:difference+
                Canada:difference+
                Ukraine:difference+
                Switzerland:difference+
                Denmark:difference+
                Belgium:difference+
                Ireland:difference+
                UK:difference+
                Germany:difference+
                France:difference+
                NZ:difference+
                US:difference+
                Japan:difference+
                Spain:difference+
                Australia:difference+
                Mexico:difference+
                India:difference+
                Singapore:difference+
                Belarus:difference+
                Russia:difference
              , data = df.filtered)
```

```{r}

summary(fit.lm.2)
par(mfrow=c(2,2))
plot(fit.lm.2)


plot(logYards ~ rate_sd1+rate_sd2+rate_sd_diff_4_1+
                avg_rate_q2+avg_rate_q3+avg_rate_q4+
                median_rate_q1+median_rate_q2+median_rate_q3+median_rate_q4+
                Finland:difference+
                Canada:difference+
                Ukraine:difference+
                Switzerland:difference+
                Denmark:difference+
                Belgium:difference+
                Ireland:difference+
                UK:difference+
                Germany:difference+
                France:difference+
                NZ:difference+
                US:difference+
                Japan:difference+
                Spain:difference+
                Australia:difference+
                Mexico:difference+
                India:difference+
                Singapore:difference+
                Belarus:difference+
                Russia:difference
              , data = df.filtered)

```

```{r}

df.filtered$logRateSD1 = log(df.filtered$rate_sd1)
df.filtered$logRateSD2 = log(df.filtered$rate_sd2)
df.filtered$logRateSD3 = log(df.filtered$rate_sd3)
df.filtered$logRateSD4 = log(df.filtered$rate_sd4)


plot(logYards~logRateSD1+logRateSD2+logRateSD3+logRateSD4+
                avg_rate_q1+avg_rate_q2+avg_rate_q3+avg_rate_q4+
                median_rate_q1+median_rate_q2+median_rate_q3+median_rate_q4+
                Age15_19+
                Age20_24+
                Age25_29+
                Age30_34+
                Age35_39+
                Age40_44+
                Age45_49+
                Age50_54+
                Age55_59+
                Age60_64+
                Finland:difference+
                Canada:difference+
                Ukraine:difference+
                Switzerland:difference+
                Denmark:difference+
                Belgium:difference+
                Ireland:difference+
                UK:difference+
                Germany:difference+
                France:difference+
                NZ:difference+
                US:difference+
                Japan:difference+
                Spain:difference+
                Australia:difference+
                Mexico:difference+
                India:difference+
                Singapore:difference+
                Belarus:difference+
                Russia:difference
              , data = df.filtered)


fit.lm.3 = lm(logYards ~ logRateSD1+logRateSD2+logRateSD3+logRateSD4+
                avg_rate_q1+avg_rate_q2+avg_rate_q3+avg_rate_q4+
                median_rate_q1+median_rate_q2+median_rate_q3+median_rate_q4+
                Age15_19+
                Age20_24+
                Age25_29+
                Age30_34+
                Age35_39+
                Age40_44+
                Age45_49+
                Age50_54+
                Age55_59+
                Age60_64+
                Finland:difference+
                Canada:difference+
                Ukraine:difference+
                Switzerland:difference+
                Denmark:difference+
                Belgium:difference+
                Ireland:difference+
                UK:difference+
                Germany:difference+
                France:difference+
                NZ:difference+
                US:difference+
                Japan:difference+
                Spain:difference+
                Australia:difference+
                Mexico:difference+
                India:difference+
                Singapore:difference+
                Belarus:difference+
                Russia:difference
              , data = df.filtered)
summary(fit.lm.3)

par(mfrow=c(2,2))
plot(fit.lm.3)
```
```{r}
df.filtered$sqrt_yards = sqrt(df.filtered$Yards)
df.filtered$cuberoot_yards = df.filtered$Yards^(-1/3)

#if all ages are 0 runner belongs to age 60-65
#if all countries*differences are 0 runner belongs to Russia

fit.lm.4 = lm(cuberoot_yards ~ logRateSD1+logRateSD2+logRateSD3+logRateSD4+
                avg_rate_q1+avg_rate_q2+avg_rate_q3+avg_rate_q4+
                median_rate_q1+median_rate_q2+median_rate_q3+median_rate_q4+
                Finland:difference
                Canada:difference+
                Ukraine:difference+
                Switzerland:difference+
                Denmark:difference+
                Belgium:difference+
                Ireland:difference+
                UK:difference+
                Germany:difference+
                France:difference+
                NZ:difference+
                US:difference+
                Japan:difference+
                Spain:difference+
                Australia:difference+
                Mexico:difference+
                India:difference+
                Singapore:difference+
                Belarus:difference
              , data = df.filtered)
summary(fit.lm.4)

par(mfrow=c(2,2))
plot(fit.lm.4)
```


```{r}
plot(Yards~difference:Canada, data = df.filtered)
```